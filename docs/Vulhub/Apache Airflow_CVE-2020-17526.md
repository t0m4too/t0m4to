# Apache Airflow 默认密钥导致的权限绕过

> 漏洞说明

pache Airflow是一款开源的，分布式任务调度框架。默认情况下，Apache Airflow无需用户认证，但管理员也可以通过指定webserver.authenticate=True来开启认证。

在其1.10.13版本及以前，即使开启了认证，攻击者也可以通过一个默认密钥来绕过登录，伪造任意用户。



> 前提条件

版本：Apache Airflow <= 1.10.13



> 利用工具

[flask-unsign](https://github.com/Paradoxis/Flask-Unsign)



> 漏洞复现

访问登陆页http://192.168.40.77:8080/admin/airflow/login

![image-20221218000033270](../img/Apache Airflow_CVE-2020-17526/image-20221218000033270.png)

可以看到服务器返回签名后的cookie

![image-20221218000118613](../img/Apache Airflow_CVE-2020-17526/image-20221218000118613.png)

利用[flask-unsign](https://github.com/Paradoxis/Flask-Unsign)爆破签名时使用的SECRET_KEY

![image-20221217232854506](../img/Apache Airflow_CVE-2020-17526/image-20221217232854506.png)

key为temporary_key,用其生成一个新的session，伪造user_id为1：

![image-20221217235847320](../img/Apache Airflow_CVE-2020-17526/image-20221217235847320.png)

修改session，成功登录

![image-20221217235956527](../img/Apache Airflow_CVE-2020-17526/image-20221217235956527.png)

![image-20221218000244134](../img/Apache Airflow_CVE-2020-17526/image-20221218000244134.png)